<!DOCTYPE html>
<html>
<head>
  <title>–ú–æ–π —Å–∞–π—Ç</title>
  <style>
    body { font-family: sans-serif; }
    h1 { color: blue; }
  </style>
</head>
<body>
  <h1>–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –æ—Ü–µ–Ω–∏–≤–∞–µ–º—ã–π —Å–∞–π—Ç</h1>
  <p>–û–Ω –≤—Å—Ç—Ä–æ–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –≤ index.html.</p>
  <div id="controls">
    <button id="like">üëç –ù—Ä–∞–≤–∏—Ç—Å—è</button>
    <button id="dislike">üëé –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è</button>
  </div>
  <script>
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) {
        return parts.pop().split(';').shift();
      }
    }

    const name = getCookie('name');
    if (!name || name === 'null' || name === 'undefined') {
      alert('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –≥–ª–∞–≤–Ω—É—é.');
      window.location.href = 'http://localhost:8000/';
    }
    console.log(name);

    async function sendVote(vote) {
  if (!name) {
    alert('–ò–º—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ cookie!');
    return;
  }

  try {
    // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å
    const voteResponse = await fetch('http://localhost:8000/api', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name: name, vote: vote })
    });

    if (!voteResponse.ok) {
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å');
    }
    
// 2. –ü–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    const nextResponse = await fetch('http://localhost:8000/api/next');
    if (!nextResponse.ok) {
      throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É');
    }

    const { next_page } = await nextResponse.json();

    // 3. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    window.location.href = `http://localhost:8000/${next_page}`;
  } catch (err) {
    console.error('–û—à–∏–±–∫–∞:', err);
    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + err.message);
  }
}

    document.getElementById('like').addEventListener('click', () => sendVote('like'));
    document.getElementById('dislike').addEventListener('click', () => sendVote('dislike'));
    let statsDiv = document.getElementById('stats');
  if (!statsDiv) {
    statsDiv = document.createElement('div');
    statsDiv.id = 'stats';
    statsDiv.style.marginTop = '15px';
    statsDiv.style.padding = '10px';
    statsDiv.style.backgroundColor = '#f0f0f0';
    statsDiv.style.borderRadius = '4px';
    statsDiv.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...';
    document.getElementById('controls').parentNode.insertBefore(statsDiv, document.getElementById('controls').nextSibling);
  }

  // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  async function fetchStats() {
    try {
      const response = await fetch(`http://localhost:8000/api/${name}`);
      if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É');
      const data = await response.json();
      statsDiv.innerHTML = `
        üëç –ù—Ä–∞–≤–∏—Ç—Å—è: <strong>${data.like}</strong>
        üëç –ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è: <strong>${data.dislike}</strong>
      `;
    } catch (err) {
      console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', err);
      statsDiv.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É';
    }
  }

  // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  fetchStats();

  // –ò –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã (3000 –º—Å)
  setInterval(fetchStats, 3000);
   </script>  
</body>
</html>